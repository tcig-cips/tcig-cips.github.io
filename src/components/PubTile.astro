---
// src/components/PubTile.astro
import { firstAuthorsEtAl } from '../lib/format.ts';

const {
  entry,
  to,                         // required: link target (e.g. "/publications/#slug" or "/publications/slug/")
  suppressTitleTransition = false, // set true on /publications to avoid duplicate title names
} = Astro.props;

const slug  = entry.slug;
const thumb = entry.data.thumbnail ?? '/images/placeholder-thumb.svg';
const firstEtAl = firstAuthorsEtAl(entry.data.authors ?? [], entry.data.first_authors);
---
<a href={to} aria-label={entry.data.title} class="block group">
  <article
    class="rounded-xl border border-black/10 p-3 transition-all duration-200 ease-out
           bg-white group-hover:bg-indigo-50 group-hover:border-indigo-200 group-hover:shadow-md"
    transition:name={`pub-${slug}`}  
  >
    <figure
      class="relative aspect-[16/9] w-full overflow-hidden rounded-lg
             bg-gray-50 ring-1 ring-gray-200 transition-colors duration-200
             group-hover:bg-white group-hover:ring-indigo-300"
    >
      <img
        src={thumb}
        alt=""
        class="absolute inset-0 h-full w-full object-contain"
        loading="lazy"
        decoding="async"
        sizes="(min-width:1024px) 33vw, (min-width:640px) 50vw, 100vw"
      />
    </figure>

    <div class="mt-2 font-medium">
      {
        suppressTitleTransition
          ? (
            /* Publications page tiles (no transition) — clamp here too */
            <span
              class="block"
              style="
                display:-webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 2;
                overflow: hidden;
                line-height: 1.25;
                max-height: 2.5em;
              "
            >
              {entry.data.title}
            </span>
          )
          : (
            /* Home tiles / table → detail — clamp on the named element */
            <span
              transition:name={`title-${slug}`}
              class="block"
              style="
                display:-webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 2;
                overflow: hidden;
                line-height: 1.25;
                max-height: 2.5em;
              "
            >
              {entry.data.title}
            </span>
          )
      }
    </div>

    <div class="mt-1 text-xs text-gray-600 flex items-center gap-2">
      <span class="inline-flex items-center rounded border px-2 py-0.5">{entry.data.venue}</span>
      <span>{entry.data.year}</span>
      {firstEtAl && <span class="truncate">{firstEtAl}</span>}
    </div>
  </article>
</a>
